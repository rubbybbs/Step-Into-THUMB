<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport"
    content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <title>管理员</title>
  <link rel="stylesheet" href="./layui/css/layui.css" media="all">
</head>

<body class="layui-layout-body">
  <div class="layui-layout layui-layout-admin">
    <div class="layui-header">
      <div class="layui-logo">军乐团活动管理</div>
      <!-- 头部区域（可配合layui已有的水平导航） -->

      <ul class="layui-nav layui-layout-right">
        <li class="layui-nav-item" lay-unselect="">
          <a href="javascript:;"><img src="./illust_72066950_20181219_203453.jpg" class="layui-nav-img">管理员</a>
          <dl class="layui-nav-child">
            <dd><a href="javascript:;">修改信息</a></dd>
            <dd><a href="javascript:;">安全管理</a></dd>
            <dd><a href="index.html">退出</a></dd>
          </dl>
        </li>
      </ul>
    </div>

    <div class="layui-side layui-bg-black">
      <div class="layui-side-scroll">
        <!-- 左侧导航区域（可配合layui已有的垂直导航） -->
        <ul class="layui-nav layui-nav-tree" lay-filter="test">
          <li class="layui-nav-item layui-nav-itemed">
            <a class="" href="javascript:;">发布活动</a>
            <dl class="layui-nav-child">
              <dd><a href="system_activityAdd.html">创建表单</a></dd>
              <dd><a href="system_accountAdd.html">添加考官</a></dd>
            </dl>
          </li>
          <li class="layui-nav-item">
            <a href="javascript:;">管理活动</a>
            <dl class="layui-nav-child">
              <dd><a href="system_activityList.html">活动列表</a></dd>
            </dl>
          </li>
          <li class="layui-nav-item layui-nav-itemed">
            <a href="javascript:;">账号管理</a>
            <dl class="layui-nav-child">
              <dd><a href="system_accountManage.html">考官账号信息管理</a></dd>
              <dd><a href="system_accountAdd.html">考官账号添加</a></dd>
            </dl>
          </li>

        </ul>
      </div>
    </div>

    <div class="layui-body" , lay-filter="graph">
      <div style="padding: 20px; background-color: #F2F2F2;">
        <div class="layui-row layui-col-space15">
          <div class="layui-col-md6">
            <div class="layui-card">
              <div class="layui-card-header">活动添加</div>
              <div class="layui-card-body">
                <form class="layui-form" action="" lay-filter="FormDesign">
                  <div class="layui-card">
                    <div class="layui-card-body">
                      <div class="layui-form-item">
                        <label class="layui-form-label">活动名称</label>
                        <div class="layui-input-block">
                          <input type="text" id="activityname" name="activityname" lay-verify="title" autocomplete="off" placeholder="请输入活动名称"
                            class="layui-input">
                        </div>
                      </div>
                      <div class="layui-form-item">
                        <label class="layui-form-label">开始日期</label>
                        <div class="layui-input-block">
                          <input type="text" name="activitystartdate" id="activitystartdate" lay-verify="date" placeholder="yyyy-MM-dd" autocomplete="off" class="layui-input">
                        </div>
                      </div>
                      <div class="layui-form-item">
                        <label class="layui-form-label">结束日期</label>
                        <div class="layui-input-block">
                          <input type="text" name="activityenddate" id="activityenddate" lay-verify="date" placeholder="yyyy-MM-dd" autocomplete="off" class="layui-input">
                        </div>
                      </div>

                      <div class="layui-form-item">
                          <div class="layui-input-block">
                            <button type="button" class="layui-btn" id="NewActivity">以该名称及时间创建新活动</button>
                          </div>
                        </div>
                    </div>  
                  </div>
                  
                  <div class="layui-card">
                      <div class="layui-card-header">个人信息统计定制区</div>
                      <div class="layui-card-body">
                        <div class="layui-form-item">
                              <label class="layui-form-label">新行名称</label>
                              <div class="layui-input-block">
                                <input type="text" name="InfoNewLine" lay-verify="title" autocomplete="off" placeholder="请输入行名称" class="layui-input">
                              </div>
                        </div>
                        <div class="layui-form-item">
                          <label class="layui-form-label">附加信息</label>
                          <div class="layui-input-block">
                            <input type="text" name="AppendInfoNewLine" lay-verify="title" autocomplete="off" placeholder="若插入选择框，请输入选项，各选项间以英文逗号隔开" class="layui-input">
                          </div>
                        </div>
                        <div class="layui-form-item">
                          <div class="layui-input-block">
                            <button type="button" class="layui-btn" id="InfoNewDataLine">增加数据输入行</button>
                            <button type="button" class="layui-btn" id="InfoNewSelectLine">增加选择框</button>
                            <button type="button" class="layui-btn" id="InfoAllDelete">删除个人信息区内容</button>
                          </div>
                        </div>
                      </div>  
                  </div>
                  
                  <div class="layui-card">
                      <div class="layui-card-header">环节定制区</div>
                      <div class="layui-card-body">
                                <div class="layui-form-item">
                                      <label class="layui-form-label">环节名称</label>
                                      <div class="layui-input-block">
                                        <input type="text" name="segmentname" lay-verify="title" autocomplete="off" placeholder="请输入行名称" class="layui-input">
                                      </div>
                                </div>
                                <div class="layui-form-item">
                                  <label class="layui-form-label">开始日期</label>
                                  <div class="layui-input-block">
                                    <input type="text" name="segmentstartdate" id="segmentstartdate" lay-verify="date" placeholder="yyyy-MM-dd" autocomplete="off" class="layui-input">
                                  </div>
                                </div>
                                <div class="layui-form-item">
                                  <label class="layui-form-label">结束日期</label>
                                  <div class="layui-input-block">
                                    <input type="text" name="segmentenddate" id="segmentenddate" lay-verify="date" placeholder="yyyy-MM-dd" autocomplete="off" class="layui-input">
                                  </div>
                                </div>
                                <div class="layui-form-item">
                                  <div class="layui-input-block">
                                    <button type="button" class="layui-btn" id="NewSegment">以该名称及时间增加新环节</button>                              
                                    <button type="button" class="layui-btn" id="ClearAllSegment">删除所有环节</button>
                                  </div>
                                </div>
                                <div class="layui-form-item">
                                  <div class="layui-form-item">
                                        <label class="layui-form-label">新行名称</label>
                                        <div class="layui-input-block">
                                          <input type="text" name="SegmentNewLine" lay-verify="title" autocomplete="off" placeholder="请输入行名称" class="layui-input">
                                        </div>
                                  </div>
                                  <div class="layui-form-item">
                                      <label class="layui-form-label">附加信息</label>
                                      <div class="layui-input-block">
                                        <input type="text" name="AppendSegmentNewLine" lay-verify="title" autocomplete="off" placeholder="若插入选择框，请输入选项，各选项间以英文逗号隔开" class="layui-input">
                                      </div>
                                    </div>
                                  <div class="layui-input-block">
                                    <button type="button" class="layui-btn" id="SegmentNewDataLine">增加数据输入行</button>
                                    <button type="button" class="layui-btn" id="SegmentNewSelectLine">增加选择框</button>
                                    <button type="button" class="layui-btn" id="SegmentAllDelete">删除环节内所有内容</button>
                                  </div>
                                </div>
                          
                      </div>  
                  </div>

                  <div class="layui-card">
                      <div class="layui-card-header">表单整体操作区</div>
                      <div class="layui-card-body">
                          <div class="layui-form-item">
                              <div class="layui-input-block">
                                <button type="submit" class="layui-btn" lay-submit="" lay-filter="submitForm">提交</button>
                                <button type="reset" class="layui-btn layui-btn-primary">重置</button>
                              </div>
                          </div>
                      </div>
                  </div>      
                </form>
              </div>
            </div>           
          </div>


          <div class="layui-col-md6">
            <div class="layui-card">
                <div class="layui-card-header">创建表单预览区</div>
                <div class="layui-card-body">
                    <form class="layui-form" id="toAdd" action="" lay-filter="FormPreview">

                    </form>
                </div>
            </div>    
          </div>
        </div>
      </div>
    </div>



  </div>

  <div class="layui-footer">
    <!-- 底部固定区域 -->
    © 小组：基于layui以及django
  </div>
  </div>


  <script src="./layui/layui.js"></script>
  <script>
    var currentSegmentNum = 0;
    var Quz = new Object();
    var Segments = new Array();
    layui.use(['form', 'layedit', 'laydate', 'jquery', 'layer'], function () {
      var form = layui.form,
        layer = layui.layer,
        $ = layui.jquery,
        layedit = layui.layedit,
        laydate = layui.laydate;

      laydate.render({elem:"#activitystartdate"});
      laydate.render({elem:"#activityenddate"});

      //监听提交
      form.on('submit(submitForm)', function (data) {
        var formId=-1;
        alert(JSON.stringify(Quz)); 

        $.ajax({
                headers: {
                  'token': layui.data('locstore').token,
                },
                url:'/Step-Into-THUMB/admin/home/create-activity',  
                type:'post',
                contentType:'application/x-www-form-urlencoded',
                dataType:'json',
                data:{name:Quz.name, date:Quz.date},
                success:function(data){
                    alert(data);
                    if (data != -1) {
                        layer.msg('表单保存成功');
                        formId = data;
                    }else {
                        layer.msg('表单保存失败，请重试！');
                    }
                }
            });
        $.ajax({
                headers: {
                  'token': layui.data('locstore').token,
                },
                url:'/Step-Into-THUMB/admin/activity/'+formId+'/create-registration-form',  
                type:'post',
                contentType:'application/json',
                dataType:'json',
                data:JSON.stringify(Quz),
                data:{},
                success:function(data){
                    alert(data);
                    if (data != -1) {
                        layer.msg('表单保存成功');
                        formId = data;
                    }else {
                        layer.msg('表单保存失败，请重试！');
                    }
                }
            });
        if (formId!=-1) {
          Segments.map(function(value, index){
            $.ajax({
                headers: {
                  'token': layui.data('locstore').token,
                },
                url:'/Step-Into-THUMB/admin/activity/'+formId+'/create-part',  
                type:'post',
                dataType:'json',
                data:JSON.stringify(value),
                success:function(data){
                    alert(data);
                    if (data != -1) {
                        layer.msg('表单保存成功');
                        formId = data;
                    }else {
                        layer.msg('表单保存失败，请重试！');
                    }
                }
            });
          });
        }    

        return false;
      });

      $("#NewActivity").click(function() {      
        var data = form.val('FormDesign');
        var startdate = data.activitystartdate.replace(/-/g, '/');
        var enddate = data.activityenddate.replace(/-/g, '/');
        Quz = {
          name:data.activityname,
          date:startdate + '-' + enddate,
          question:new Array()
        };
        //alert(JSON.stringify(data)); 
        $("#toAdd").append(
          '<div class="layui-card"> \
              <div class="layui-card-header">' + data.activityname + '    ' + startdate + '-' + enddate + '</div> \
              <div class="layui-card-body" id="FormPreViewBody"> \
                <div class="layui-card"> \
                  <div class="layui-card-header"> 个人信息 </div> \
                    <div class="layui-card-body" id="FormPreViewInfoBody"> \
                      \
                    </div> \
                </div>\
                <div class="layui-card"> \
                  <div class="layui-card-header"> 环节信息 </div> \
                    <div class="layui-card-body" id="FormPreViewSegmentBody"> \
                      \
                    </div> \
                </div>\
              </div> \
          </div>'    
        );
        form.render();
      });
      
      $("#InfoNewDataLine").click(function() {     
        var data = form.val('FormDesign'); 
        //alert(JSON.stringify(data)); 
        Quz["question"].push({
          name: data.InfoNewLine,
          type: "Blank"
        });
        $("#FormPreViewInfoBody").append(
          '<div class="layui-form-item"> \
              <label class="layui-form-label">' + data.InfoNewLine + '</label> \
              <div class="layui-input-block"> \
                <input type="text" name="username" lay-verify="title" autocomplete="off" placeholder="请输入内容" class="layui-input"> \
              </div> \
          </div>'    
        );
        form.render();
      });

      $("#InfoNewSelectLine").click(function() {     
        var data = form.val('FormDesign'); 
        var strs = new Array(); 
        strs = data.AppendInfoNewLine.split(","); 

        var ChoiceArr=new Array();
        strs.map(function(value,index,arr){
          ChoiceArr.push({Choice:value});
        });
        Quz["question"].push({
          name: data.InfoNewLine,
          type: "Choice",
          Choices: ChoiceArr
        });
        
        var modestr = '<div class="layui-form-item"> \
            <label class="layui-form-label">' + data.InfoNewLine + '</label> \
            <div class="layui-input-block"> \
              <select name="example" lay-filter="show"> \
                <option value=""></option> ';
        strs.map(function(value,index,arr){
          modestr += '<option value="' + index.toString() + '">' + value + '</option>';
        });               
        modestr += '</select> \
            </div> \
          </div>';
        $("#FormPreViewInfoBody").append(modestr);
        //alert(modestr);
        form.render();
      });

      $("#InfoAllDelete").click(function() {
        Quz["question"].splice(0);
        $("#FormPreViewInfoBody").empty();
        form.render();
      });

      $("#NewSegment").click(function() {     
        currentSegmentNum++;
        var data = form.val('FormDesign'); 
        var startdate = data.segmentstartdate.replace(/-/g, '/');
        var enddate = data.segmentenddate.replace(/-/g, '/');
        Segments.push({
          name:data.segmentname,
          date:startdate + '-' + enddate,
          question:new Array()
        });
        $("#FormPreViewSegmentBody").append(' \
                <div class="layui-card"> \
                  <div class="layui-card-header"> ' + data.segmentname + '  ' + startdate + '-' + enddate + ' </div> \
                    <div class="layui-card-body" id="FormPreViewSegmentBody' + currentSegmentNum.toString() + '"> \
                      \
                    </div> \
                </div>');
        form.render();
      });

      $("#ClearAllSegment").click(function() {  
        Segments.splice(0);   
        currentSegmentNum = 0;
        var data = form.val('FormDesign'); 
        $("#FormPreViewSegmentBody").empty();
        form.render();
      });

      $("#SegmentNewDataLine").click(function() {     
        var data = form.val('FormDesign'); 
        Segments[currentSegmentNum-1]["question"].push({
          name: data.SegmentNewLine,
          type: "Blank"
        });
        $("#FormPreViewSegmentBody" + currentSegmentNum.toString()).append(
          '<div class="layui-form-item"> \
              <label class="layui-form-label">' + data.SegmentNewLine + '</label> \
              <div class="layui-input-block"> \
                <input type="text" name="username" lay-verify="title" autocomplete="off" placeholder="请输入内容" class="layui-input"> \
              </div> \
          </div>'    
        );
        form.render();
      });

      $("#SegmentNewSelectLine").click(function() {     
        var data = form.val('FormDesign'); 
        var strs = new Array(); 
        strs = data.AppendSegmentNewLine.split(","); 

        var ChoiceArr=new Array();
        strs.map(function(value,index,arr){
          ChoiceArr.push({Choice:value});
        });
        Segments[currentSegmentNum-1]["question"].push({
          name: data.SegmentNewLine,
          type: "Choice",
          Choices: ChoiceArr
        });

        var modestr = '<div class="layui-form-item"> \
            <label class="layui-form-label">' + data.SegmentNewLine + '</label> \
            <div class="layui-input-block"> \
              <select name="example" lay-filter="show"> \
                <option value=""></option> ';
        strs.map(function(value,index,arr){
          modestr += '<option value="' + index.toString() + '">' + value + '</option>';
        });               
        modestr += '</select> \
            </div> \
          </div>';
        $("#FormPreViewSegmentBody" + currentSegmentNum.toString()).append(modestr);
        form.render();
      });

      $("#SegmentAllDelete").click(function() {   
        Segments[currentSegmentNum-1]["question"].splice(0);  
        $("#FormPreViewSegmentBody" + currentSegmentNum.toString()).empty();
        form.render();
      });

    });

    layui.use('element', function () {
      var element = layui.element; //导航的hover效果、二级菜单等功能

    });
  </script>
</body>

</html>